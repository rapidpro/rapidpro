# -*- coding: utf-8 -*-
# Generated by Django 1.11.2 on 2017-08-01 11:18
from __future__ import absolute_import, division, print_function, unicode_literals

from django.db import migrations
import uuid


def populate_contact_field_uuids(apps, schema_editor):
    ContactField = apps.get_model('contacts', 'ContactField')

    field_ids = list(ContactField.objects.filter(uuid=None).values_list('id', flat=True))
    if not field_ids:
        return

    print("Fetched %d fields to set UUIDs on" % len(field_ids))
    num_updated = 0

    for field_id in field_ids:
        ContactField.objects.filter(id=field_id).update(uuid=uuid.uuid4())
        num_updated += 1

        if num_updated % 1000 == 0:
            print(" > Updated %d of %d contact fields" % (num_updated, len(field_ids)))


class Migration(migrations.Migration):

    dependencies = [
        ('contacts', '0061_contactfield_uuid'),
    ]

    operations = [
        migrations.RunPython(populate_contact_field_uuids)
    ]
