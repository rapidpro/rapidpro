!function(a){"use strict";function b(a,b,c){var d;return function(){var e=this,f=arguments,g=function(){d=null,c||a.apply(e,f)},h=c&&!d;clearTimeout(d),d=setTimeout(g,b),h&&a.apply(e,f)}}function c(b,c){this.options=a.extend({items:".sortable",handles:null,zindex:"9000",dragX:!0,dragY:!0,onChange:null,onDragstart:null,onDrag:null,onDragend:null},c);var d=b.scope().$id;this.classes={};for(var f in e)this.classes[f]=e[f]+"-"+d;this.deltaX=0,this.deltaY=0,this.enabled=null,this.state=null,this.$element=a(b),this.$activeItem=null,this.refresh()}var d={drag:"mousemove touchmove",dragstart:"mousedown touchstart",dragend:"mouseup touchend",selectstart:"selectstart"},e={sorting:"sortable-sorting",item:"sortable-item",handle:"sortable-handle",clone:"sortable-clone",active:"sortable-activeitem"},f=a(document.body),g=2;c.prototype.enable=function(a){this.enabled=a},c.prototype.cleanup=function(){f.attr("unselectable",self.bodyUnselectable).off(d.dragend).off(d.drag).off(d.selectstart),this.getItems().off(d.dragstart)},c.prototype.getItems=function(){return a(this.options.items,this.$element)},c.prototype.refresh=function(){this.cleanup();var a=this,b=this.getItems();b.addClass(a.classes.item),b.attr("unselectable","on"),this.enabled&&(this.$activeItem||b.bind(d.dragstart,function(c){b.unbind(c),a.dragstart(c)}))};var h=b(function(a){var b,c=a.getItems(),d=0,e=c.length,f=parseInt(a.$dragElement.css("top"),10),g=parseInt(a.$dragElement.css("left"),10),h=g-a.left,i=f-a.top;if(a.options.dragX){if(!a.options.dragY)if(h>0)d=a.draggingIdx+1;else{if(!(0>h))return;e=a.draggingIdx}}else if(i>0)d=a.draggingIdx+1;else{if(!(0>i))return;e=a.draggingIdx}for(;e>d;d++)if(b=c[d],d!==a.draggingIdx&&(a.options.dragY&&f>b.offsetTop&&f<b.offsetTop+b.offsetHeight||a.options.dragX&&g>b.offsetLeft&&g<b.offsetLeft+b.offsetWidth)){a.options.onChange(a.draggingIdx,d),a.draggingIdx=d,a.dragged=!0,a.left=g,a.top=f;break}},g);c.prototype.drag=function(a){a.isPropagationStopped()||(this.options.onDrag(a),this.options.dragY&&this.$dragElement.css("top","+="+(a.clientY-this.state.clientY)),this.options.dragX&&this.$dragElement.css("left","+="+(a.clientX-this.state.clientX)),h(this,a),this.state=a)},c.prototype.dragstart=function(b){if(1===b.which&&!b.isPropagationStopped()){var c=this;this.dragged=!1;var e=a(b.target),g=this.getItems();if(!this.options.handles||(this.options.handles&&g.find(this.options.handles).addClass(this.classes.handle),e.closest("."+this.classes.handle).length)){this.options.onDragstart(b),b.target=function(){return e.hasClass(c.classes.item)?b.target:e.closest("."+c.classes.item)[0]}(),c.bodyUnselectable=f.attr("unselectable"),f.attr("unselectable","on"),this.$activeItem=a(b.target).addClass(c.classes.active);var h=this.$activeItem.position();c.draggingIdx=Array.prototype.indexOf.call(g,c.$activeItem[0]),this.top=h.top,this.left=h.left,this.$dragElement=a(b.target).clone().css({"z-index":this.options.zindex,width:this.$activeItem[0].offsetWidth,height:this.$activeItem[0].offsetHeight,top:h.top,left:h.left}).removeClass(c.classes.item).addClass(c.classes.clone).appendTo(b.target.parentNode),this.$element.addClass(c.classes.sorting),this.getItems().off(d.dragstart),f.bind(d.drag,function(a){c.drag(a)}).bind(d.dragend,function(a){f.unbind(a),c.dragend(a)}).bind(d.selectstart,function(a){return a.preventDefault(),!1}),this.state=b}}},c.prototype.dragend=function(a){if(!a.isPropagationStopped()){var b=this;b.draggingIdx=null;var c=this.getItems();f.attr("unselectable",b.bodyUnselectable).off(d.drag).off(d.dragend).off(d.selectstart),c.bind(d.dragstart,function(a){return c.unbind(a),b.dragstart(a)}),this.dragged?this.options.onDragend(a):this.state.originalEvent.target.click(),this.$activeItem.removeClass(this.classes.active),this.$activeItem=null,this.$element.removeClass(this.classes.sorting),this.$dragElement.remove()}};var i=function(a,b){var c=a.$root.$$phase;"$apply"===c||"$digest"===c?b&&"function"==typeof b&&b():a.$root.$apply(b)};angular.module("sortable",[]).factory("ngSortableOptions",function(){return{}}).directive("ngSortable",["ngSortableOptions",function(b){return{restrict:"A",scope:{ngSortable:"=",ngSortableDirection:"@",ngSortableItems:"@",ngSortableHandles:"@",ngSortableZindex:"@",ngSortableDisable:"=",ngSortableOnChange:"=",ngSortableOnDrag:"=",ngSortableOnDragstart:"=",ngSortableOnDragend:"="},link:function(d,e){function f(a,c){i(d,function(){var e=g.splice(a,1);g.splice(c,0,e[0]),d.ngSortableOnChange?d.ngSortableOnChange(a,c):b.onChange&&b.onChange(a,c)})}var g=d.ngSortable;g||(g=[]);var h=d.ngSortableDirection||b.direction,j={items:d.ngSortableItems||b.items,handles:d.ngSortableHandles||b.handles,zindex:d.ngSortableZindex||b.zindex,onChange:f,onDrag:d.ngSortableOnDrag||b.onDrag||a.noop,onDragstart:d.ngSortableOnDragstart||b.onDragstart||a.noop,onDragend:d.ngSortableOnDragend||b.onDragend||a.noop,dragX:"vertical"!==h,dragY:"horizontal"!==h},k=new c(e,j);d.$watch("ngSortableDisable",function(){k.enable(!d.ngSortableDisable)}),d.$watch(function(){return a("."+k.classes.item,e).length},function(){k.refresh()}),e.on("$destroy",function(){console.log("angular-sortable destroy"),k.cleanup()})}}}])}(jQuery);